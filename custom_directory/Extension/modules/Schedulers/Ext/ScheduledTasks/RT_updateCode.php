<?php
array_push($job_strings, 'RT_updateCode');

function RT_updateCode()
{
    $codesToUpdate = [
        "aBerry" => "ABY",
        "ABBOTT NUTRITION" => "ABT",
        "ABSOLUT" => "PED",
        "Accolade Wines (Europe)" => "",
        "ADM" => "",
        "Ajinomoto" => "",
        "ALL ABOUT" => "AAF",
        "Allergan" => "ALN",
        "Alliance Loire" => "ALE",
        "Alpen" => "Alpen",
        "Alpha UK" => "ALK",
        "ALPRO" => "DAE",
        "A2 MILK" => "",
        "AMWAY" => "AMY",
        "ANADOLU EFES" => "ANS",
        "Company of Animals" => "COS",
        "ARLA" => "",
        "AVIKO" => "AVO",
        "Avon" => "",
        "BARILLA" => "",
        "BARRY CALLEBAUT" => "BUT",
        "BAHLSEN" => "BAN",
        "BACARDI" => "",
        "BALL" => "BLL",
        "BAUSCH & LOMB" => "BAB",
        "BANZA" => "BNZ",
        "BARNARDO'S" => "BAS",
        "BAT" => "",
        "BEIERSDORF" => "BEF",
        "BEL" => "BEL",
        "BEAM SUNTORY" => "BSU",
        "BROWN-FORMAN" => "",
        "The Bingo Association" => "BIO",
        "BIC" => "",
        "BLUE DIAMOND" => "BDA",
        "Blount Fine Foods" => "BLO",
        "Black Swan" => "Black",
        "BOL Foods" => "BOS",
        "BRITVIC SOFT DRINKS" => "",
        "BRF" => "BRF",
        "BRITA" => "BRA",
        "BEYOND MEAT" => "",
        "Bayer" => "",
        "CAMPBELLS" => "",
        "CAWSTON PRESS" => "CP",
        "Carma Labs" => "",
        "Coca-Cola" => "",
        "C'ESTBONE (Yi Bao)" => "YB",
        "CHURCH & DWIGHT" => "CHT",
        "CHIQUITA" => "CHA",
        "Clariant" => "CLT",
        "CLIF BAR & COMPANY" => "CLB",
        "Clorox" => "CLX",
        "Clusters" => "CLS",
        "COORS BREWERS" => "COR",
        "COLGATE PALMOLIVE" => "",
        "Compusense" => "MDZCOE",
        "Corbion" => "CBN",
        "Concentric Product Solutions" => "",
        "COTY" => "COY",
        "Charoen Pokphand Foods Public Company Li" => "CPF",
        "CEREAL PARTNERS" => "",
        "Dave's Bread" => "DKB",
        "DAIRY FARMERS OF AMERICA" => "DCA",
        "Dairy Management Inc." => "DMI",
        "Daiya Foods" => "",
        "Deliveroo" => "DEO",
        "DGA" => "",
        "DIAGEO" => "",
        "Distell" => "",
        "DOVES FARM" => "DOM",
        "DOLE" => "",
        "DRISCOLL'S" => "DRL",
        "DR OETKER" => "",
        "DR SCHAER" => "",
        "DSG International (Thailand) Public Comp" => "DSG",
        "Dunkin Donuts" => "DUS",
        "DYSON" => "DYN",
        "Economics of Mutuality" => "ECY",
        "EDRINGTON GROUP" => "EDN",
        "UNILEVER" => "",
        "ESTEE" => "",
        "FRIESLANDCAMPINA" => "",
        "FERRERO" => "",
        "FERRARA" => "FERA",
        "FIRMENICH" => "",
        "Flash Express" => "FLS",
        "F&N" => "FNG",
        "FONTERRA" => "FOA",
        "Food Strategy Associates" => "",
        "Food Science Fusion" => "FON",
        "Fry's Family Food" => "Fry's",
        "Fyffes Group" => "FYS",
        "GALDERMA" => "GAA",
        "GENERAL MILLS" => "GES",
        "G'S FRESH" => "",
        "GIVE & GO" => "GGO",
        "GIVAUDAN" => "",
        "GSK" => "",
        "Goodlife Foods" => "GLF",
        "GOOD SENSE RESEARCH" => "GOS",
        "GRAZE" => "GRE",
        "Grenade" => "",
        "GU" => "GU",
        "Harris Interactive" => "HAE",
        "HALLMARK" => "HAK",
        "Haribo" => "",
        "HARRY'S" => "HAR",
        "Healthcare at Home" => "SCS",
        "HEINEKEN" => "",
        "HENKEL" => "HEL",
        "Hershey's" => "HEY",
        "KraftHeinz" => "",
        "HAPPI FOODI" => "",
        "HotTea Mama" => "HOA",
        "HRW" => "",
        "HUTCHISON 3G UK HOLDINGS LIMITED" => "THE",
        "Huxly Global" => "MMR",
        "HYP" => "",
        "Hycon Research Co Limited" => "HYN",
        "ICELANDIC PROVISIONS" => "ICS",
        "IFF" => "",
        "IMPOSSIBLE FOODS" => "IME",
        "IND" => "",
        "INSPIRE BRANDS" => "",
        "INGREDION" => "INN",
        "INNOCENT" => "INT",
        "INTERNAL" => "MMRGroup",
        "Illva Saronno S.p.A." => "ILO",
        "JAB HOLDING" => "KME",
        "Jacobs Douwe Egberts" => "JAS",
        "Jasper Hill Farms" => "JHF",
        "JBS Foods" => "JBS",
        "J.MACEDO" => "JMO",
        "JOHNSONVILLE" => "JSV",
        "JOHNSON & JOHNSON" => "JON",
        "JORDANS" => "JOA",
        "Juul" => "JUS",
        "Keurig Dr Pepper" => "KDP",
        "KELLOGG'S" => "LL",
        "KETCHUM" => "KEM",
        "KERRY FOODS" => "",
        "KFC" => "",
        "KIMBERLEY-CLARK" => "KIK",
        "KIND" => "KIS",
        "KOHLER" => "KOH",
        "KP SNACKS" => "",
        "LACTALIS" => "LAS",
        "Landcorp Farming Limited" => "LAD",
        "LambWeston" => "LWE",
        "LAND O'LAKES" => "LOL",
        "LAVAZZA" => "LAA",
        "LEEKUMKEE" => "LKK",
        "LES MILLS" => "LES",
        "LiveKindly Collective" => "LIV",
        "Little Leaf Farms" => "LIF",
        "LITTLE MOONS" => "LIM",
        "Linney" => "LIY",
        "LINTBELLS" => "LIS",
        "Liang Yuan" => "LY",
        "Long John Silver" => "LJS",
        "L'OREAL" => "LOR",
        "LUCOZADE" => "",
        "Master Kong" => "MK",
        "Maple Leaf Foods" => "",
        "MARS" => "",
        "MATTEL INC" => "MAL",
        "AB Mauri" => "ABM",
        "MARLOE WATCH COMPANY" => "MWC",
        "Mary Kay" => "",
        "MCCORMICK" => "MCK",
        "MCCAIN FOODS" => "MCN",
        "MCDONALDS" => "",
        "mdi global" => "",
        "MONDELEZ" => "",
        "MEATLESS FARM" => "MRM",
        "MENGNIU" => "MN",
        "MILLER COORS" => "MIS",
        "Midea Group" => "MID",
        "Misfits Health" => "MIT",
        "Mission Deli" => "",
        "Milkana" => "MIA",
        "Mead Johnson Nutrition Pte Ltd" => "",
        "MMRINC" => "MMRINC",
        "MODERN BAKER" => "MOR",
        "MOM Group" => "MOM",
        "Monde Nissin" => "",
        "MOET HENNESSY" => "",
        "M Water Co.Ltd." => "MW",
        "NANDOS" => "NAN",
        "Nerudia" => "NEA",
        "Nomad Foods" => "",
        "NOMAD" => "IG",
        "NOMNOMNOW INC" => "NNN",
        "Oatly" => "OATLY",
        "OCEAN SPRAY" => "",
        "ORIFLAME" => "ORE",
        "ORNUA" => "ORA",
        "PAPA JOHN'S" => "PJI",
        "Pabst" => "",
        "PEOPLE AGAINST DIRTY" => "ECV",
        "PEPSICO" => "",
        "PHILIP MORRIS" => "",
        "Piccolo" => "PIC",
        "Pizza Express" => "PEX",
        "PIONEER FOODS" => "PIO",
        "Pizza Hut" => "PIT",
        "PILGRIM'S" => "PIM",
        "Pladis" => "PLS",
        "PLENISH" => "PLH",
        "ASAHI" => "AHI",
        "PREMIER" => "PRS",
        "Premier Foods" => "PRE",
        "PROCTER & GAMBLE" => "PGE",
        "PicSolve" => "PIE",
        "Pip & Nut" => "TEST",
        "QUORN FOODS" => "",
        "Restaurant Brands International" => "RBI",
        "Red Bull Company Ltd" => "RB",
        "REGULUS PARTNERS" => "RES",
        "READING UNI" => "UNI",
        "Ramsay Health Care UK Operations Ltd" => "RAH",
        "Rich Product Corporation" => "RIS",
        "MMRRW" => "MMRRW",
        "Royal DSM" => "DSM",
        "ROYAL SHAKESPEARE" => "RSC",
        "RUBIES" => "RUS",
        "SABRA DIPPING" => "SBA",
        "SANOFI" => "SAI",
        "SC Johnson" => "SCN",
        "Sci MX" => "SCX",
        "SEARCYS" => "SES",
        "SINGAPORE POLYTECHNIC" => "SP",
        "SIQALO" => "Spreads",
        "Science in Sport plc" => "",
        "The Skinny Food Co" => "SKO",
        "Soda Stream" => "SDS",
        "Spiked Beverages Ltd" => "SPD",
        "SPECTRUM BRANDS" => "SPM",
        "SUNTORY" => "SUN",
        "STAGECOACH" => "Virgin",
        "Staples" => "STP",
        "St Pierre Groupe" => "SPG",
        "Subway" => "SUY",
        "Swarovski" => "SWA",
        "SYMRISE" => "SYE",
        "TATA" => "",
        "TATE & LYLE" => "TAE",
        "TAKE TWO FOODS" => "TAO",
        "Tea Forte" => "TEE",
        "Temasek Polytechnic" => "TEC",
        "TTI Floorcare North America" => "TTA",
        "THAI COCONUT" => "THT",
        "TIGER BRAND" => "TIG",
        "Tiny Tummies Ltd" => "Baby",
        "Tecnoquimicas" => "CALITQ",
        "Traditional Medicinals" => "TRS",
        "Twinings" => "TWS",
        "UCC Coffee" => "UCC",
        "UPWARD FARMS" => "UPF",
        "VIMTO" => "",
        "WE ARE ALEXANDER" => "WAA",
        "WESTLAND MILK PRODUCTS" => "WED",
        "WEETABIX" => "",
        "WGMF" => "",
        "WHITBREAD" => "WHD",
        "THE WOLF GROUP" => "WLF",
        "WYETH" => "WYH",
        "Zespri" => "ZEI",
        "Welch's" => "WEL",
        "Westlab" => "",
        "YILI GROUP" => "YIL",
    ];
    $startIndex = RT_general_getIndexed('RT_updateCodeOffset');
    $slicedArray = array_slice($codesToUpdate, $startIndex, 100, true);
    if(sizeof($slicedArray)==0)
    {
        $query = $GLOBALS['db']->query('Update schedulers set status = "Inactive" where name = "RT_updateCode"');
    }
    foreach ($slicedArray as $name => $code) {
        $query = "update `accounts_cstm` set accounts_cstm.acc_unique_code_c=\"$code\" where `accounts_cstm`.`id_c`IN (Select id from accounts where accounts.name = \"$name\" and deleted = 0 )";
        $result = $GLOBALS['db']->query($query);
        if (!$result) {
            $GLOBALS['log']->fatal("ERROR updating code for accounts record named: " . $name);
        }
    }
    RT_general_updateIndexed('RT_updateCodeOffset', sizeof($slicedArray));
    return true;
}
function RT_general_getIndexed($name)
{
    $result = $GLOBALS['db']->query("SELECT value FROM config WHERE name='" . $name . "'");
    $row = $GLOBALS['db']->fetchByAssoc($result);
    return $row['value'];

}
function RT_general_updateIndexed($name, $size)
{
    $result = $GLOBALS['db']->query('Update config set value = value + ' . $size . ' WHERE name="' . $name . '"');
}
